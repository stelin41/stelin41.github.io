<!doctype html><html lang=es><head><title>Laser Trainer Pro :: stelin41</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Esta es una aplicación para entrenamiento deportivo que publiqué en 2021, y a continuación voy a explicar el proceso de desarrollo y los principales problemas con los que me encontré"><meta name=keywords content="laser,trainer,pro,dry shooting,laser,IPSC,precision,tiro en seco,kivy,"><meta name=robots content="noodp"><link rel=canonical href=https://stelin41.github.io/es/posts/laser_trainer_pro/><link rel=stylesheet href=https://stelin41.github.io/assets/style.css><link rel=stylesheet href=https://stelin41.github.io/assets/green.css><link rel=apple-touch-icon href=https://stelin41.github.io/img/apple-touch-icon-192x192.png><link rel="shortcut icon" href=https://stelin41.github.io/img/favicon.ico><meta name=twitter:card content="summary"><meta name=twitter:site content="https://twitter.com/stelin41"><meta name=twitter:creator content="stelin41"><meta property="og:locale" content="es"><meta property="og:type" content="article"><meta property="og:title" content="Laser Trainer Pro"><meta property="og:description" content="Esta es una aplicación para entrenamiento deportivo que publiqué en 2021, y a continuación voy a explicar el proceso de desarrollo y los principales problemas con los que me encontré"><meta property="og:url" content="https://stelin41.github.io/es/posts/laser_trainer_pro/"><meta property="og:site_name" content="stelin41"><meta property="og:image" content="https://stelin41.github.io/img/laser_trainer_pro_es.png"><meta property="og:image:width" content="2048"><meta property="og:image:height" content="1024"><meta property="article:published_time" content="2022-11-25 00:00:00 +0000 UTC"></head><body class=green><div class="container center headings--one-size"><header class=header><div class=header__inner><div class=header__logo><a href=/es><div class=logo>stelin41</div></a></div><div class=menu-trigger>menu</div></div><nav class=menu><ul class="menu__inner menu__inner--desktop"><li><a href=/es>Página principal</a></li><li><a href=/es/posts>Publicaciones</a></li><li><a href=/es/tags>Etiquetas</a></li><li><a href=/es/contact>Contacto</a></li><ul class=menu__sub-inner><li class=menu__sub-inner-more-trigger>Proyectos ▾</li><ul class="menu__sub-inner-more hidden"><li><a href=/es/posts/flying_poo>Flying Poo</a></li><li><a href=/es/posts/laser_trainer_pro>Laser Trainer Pro</a></li></ul></ul><div class=spacer></div><ul class=language-selector><ul class=language-selector-current><li>Español ▾</li></ul><ul class="language-selector__more hidden"><li><a href=https://stelin41.github.io/en/>English</a></li><li><a href=https://stelin41.github.io/es/>Español</a></li></ul></ul></ul><ul class="menu__inner menu__inner--mobile"><li><a href=/es>Página principal</a></li><li><a href=/es/posts>Publicaciones</a></li><li><a href=/es/tags>Etiquetas</a></li><li><a href=/es/contact>Contacto</a></li><li><a href=/es/posts/flying_poo>Flying Poo</a></li><li><a href=/es/posts/laser_trainer_pro>Laser Trainer Pro</a></li><hr><li><a href=https://stelin41.github.io/en/>English</a></li><li><a href=https://stelin41.github.io/es/>Español</a></li></ul></nav></header><div class=content><div class=post><h1 class=post-title><a href=https://stelin41.github.io/es/posts/laser_trainer_pro/>Laser Trainer Pro</a></h1><div class=post-meta><span class=post-date>2022-11-25</span></div><span class=post-tags>#<a href=https://stelin41.github.io/es/tags/crear/>crear</a>&nbsp;
#<a href=https://stelin41.github.io/es/tags/app/>app</a>&nbsp;
#<a href=https://stelin41.github.io/es/tags/python/>python</a>&nbsp;
#<a href=https://stelin41.github.io/es/tags/kivy/>kivy</a>&nbsp;
#<a href=https://stelin41.github.io/es/tags/android/>android</a>&nbsp;
#<a href=https://stelin41.github.io/es/tags/ios/>IOS</a>&nbsp;</span>
<img src=https://stelin41.github.io/img/laser_trainer_pro_es.png class=post-cover alt="Laser Trainer Pro" title="Cover Image"><div class=post-content><div><h1 id=introducción>Introducción<a href=#introducción class=hanchor arialabel=Anchor>&#8983;</a></h1><p>Este es el segundo proyecto que he llegado a publicar. Es una aplicación de deportes para practicar la puntería desde casa. Sin duda este proyecto fué mucho más difícil e interesante de desarrollar que <a href=/es/posts/flying_poo>Flying Poo</a>, el anterior que hice. Lo publiqué en 2021 y tardé unos dos meses para desarrollarlo.</p><p>Tráiler:</p><div style=position:relative;padding-bottom:56.25%;height:0;overflow:hidden><iframe src=https://www.youtube-nocookie.com/embed/yQjpZzEaq-s style=position:absolute;top:0;left:0;width:100%;height:100%;border:0 allowfullscreen title="YouTube Video"></iframe></div><h1 id=el-desarrollo>El desarrollo<a href=#el-desarrollo class=hanchor arialabel=Anchor>&#8983;</a></h1><p>Exceptuando unas cinco líneas de código que hicieron falta para hacer que la cámara funcionase correctamente en IOS, todo está programado en Python usando un framework multiplataforma llamado Kivy. Lo hice así por dos razones: la primera es para acostumbrarme más a programar en Python, y la segunda es para no tener que reimplementar el mismo código para cada plataforma.</p><p>A primera vista, el principal reto para crear este programa es conseguir detectar la posición del láser. De hecho, esta fué una parte bastante divertida. Al principio pensé que usar redes neuronales podría ser una buena solución, pero acabé teniendo una mejor idea. Primero hice una gravación de prueba, donde aparecen diferentes disparos del láser, y luego usé la librería de OpenCV (aunque más tarde tuve que cambiarla por Numpy, porque no hay una receta que lo compile para IOS) para experimentar con varias ideas.</p><p>Tras muchos experimentos y pruebas se me ocurrió calcular la diferencia entre los píxeles del fotograma actual y el anterior, y funcionó sorprendentemente bien. Aparecía algo de ruido, pero se solucionó al filtrar los píxeles que variaban menos. Luego solo fué jugar un poco con los parámetros para mejorar los resultados. Aunque en condiciones de alta luminosidad el láser apenas destaca entre el ruido causado por la luz ambiental, por lo que tuve que implementar una función que detecta si este es el caso y avise al usuario. Decidí usar solo una de las capas RGB para ahorrar recursos y descubrí que el canal verde es el que detecta el láser más limpiamente (algo que me pareció curioso, ya que el láser que usé para las pruebas es rojo). Para calcular la puntuación, apliqué una máscara para saber dentro de qué anillo impactó el láser.</p><h1 id=los-problemas>Los problemas<a href=#los-problemas class=hanchor arialabel=Anchor>&#8983;</a></h1><p>Después vino la parte algo menos entretenida: llevarlo a una aplicación real. Esta parte no tiene mucho misterio, y como la mayoría de proyectos de desarrollo de software se podría resumir en tres pasos: decidir cuál será el siguiente paso; googlear cómo hacer X; buscar porqué no funciona Z; y repetir. Este método funciona siempre y cuando alguien haya tenido un problema parecido antes o exista algún tipo de documentación. Dada la reducida comunidad que tiene Kivy, es de esperar que aparezcan problemas nunca planteados, pero cuando ni siquiera hay documentación que esté relacionada, esto se vuelve un verdadero problema.</p><p>Al intentar migrar el código a IOS, resultó que ya no podía acceder al buffer de la cámara para poder manipular la imágen. Como nada de esto está documentado, mi única opción era leer el código fuente de Kivy, y resulta que en la implementación de Kivy para IOS el código que usaba para acceder al buffer era inexistente, y no tengo conocimientos suficientes sobre IOS como para poder implementarlo por mí mismo. Mientras leía el código me daba cuenta de que mis opciones se reducían cada vez más, y empecé a entrar en desesperación. Pedir ayuda podría no ser una opción, ya que nadie ha sido capaz de capturar el buffer de la cámara en IOS&mldr; ¿o tal vez sí? Ahí es donde entra mi salvación: <a href=https://github.com/kivy-garden/zbarcam>zbarcam</a>, un escáner de códigos de barra y QRs.</p><p>Al parecer los desarrolladores de este paquete fueron los únicos que, usando Kivy, han sido capaces de acceder al buffer de la cámara desde IOS. Para facilitar el proceso y no tener que modificar el código fuente directamente, opté por importarlo y usar la magia de la POO para heredar las características de cualquier clase y poder modificar sus funciones a gusto.</p><h1 id=resultados>Resultados<a href=#resultados class=hanchor arialabel=Anchor>&#8983;</a></h1><p>Gracias a este proyecto, pulí mis habilidades con Python y tuve una primera degustación de cómo es la investigación en el área de la computación, y resultó ser bastante divertido. Eso sí, me he saltado muchos problemas que tuve en este resumen, como usar las APIs de Android e IOS desde Python para poder imprimir la diana, o corregir la orientación de la cámara en IOS accediendo a la API del giroscopio y medir la inclinación (porque por algún motivo IOS gira por defecto la imágen en función de la orientación del teléfono, y no pude encontrar ninguna forma de desactivarlo con Kivy).</p><p>Dejo por aquí los enlaces a <a href="https://play.google.com/store/apps/details?id=com.payday444.lasertrainerpro&hl=es&gl=ES">Google Play</a> y a la <a href=https://apps.apple.com/es/app/laser-trainer-pro/id1579891923>App Store</a> por si le interesa a alguien.</p></div></div><div class=pagination><div class=pagination__title><span class=pagination__title-h>Leer otras publicaciones</span><hr></div><div class=pagination__buttons><span class="button next"><a href=https://stelin41.github.io/es/posts/flying_poo/><span class=button__text>Flying Poo</span>
<span class=button__icon>→</span></a></span></div></div></div></div><footer class=footer><div class=footer__inner><div class="copyright copyright--user"><span>© 2022 stelin41</span>
<span>:: Powered by the <a href=https://themes.gohugo.io/themes/hugo-theme-terminal/>terminal</a> theme for <a href=http://gohugo.io>Hugo</a></span></div></div></footer><script src=https://stelin41.github.io/assets/main.js></script><script src=https://stelin41.github.io/assets/prism.js></script><script src=https://stelin41.github.io/assets/languageSelector.js></script></div></body></html>